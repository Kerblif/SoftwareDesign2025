# Микросервисная архитектура анализатора текста

Этот проект реализует микросервисную архитектуру для анализа текстовых файлов, включая расчет статистики, обнаружение плагиата и генерацию облака слов.

## Выполнение требований

### Функциональные требования

1. ✅ **Подсчёт статистики:** 
   - Реализован подсчет количества абзацев, слов и символов в тексте
   - API endpoint: `POST /api/v1/analysis` возвращает `paragraph_count`, `word_count`, `character_count`

2. ✅ **Сравнение файлов на схожесть:**
   - Реализовано сравнение файлов для выявления 100% плагиата среди ранее присланных отчетов
   - API endpoint: `POST /api/v1/analysis` возвращает `is_plagiarism` и `similar_file_ids`

3. ✅ **Визуализация данных (облака слов):**
   - Реализована генерация облака слов с использованием внешнего API
   - API endpoint: `POST /api/v1/analysis` с параметром `generate_word_cloud: true` инициирует создание облака слов
   - API endpoint: `GET /api/v1/wordcloud/{location}` позволяет получить сгенерированное облако слов

### Архитектурные требования

1. ✅ **Микросервисная архитектура:**
   - Система разделена на три микросервиса с четким разделением ответственности:
     - **API Gateway** - отвечает за маршрутизацию запросов
     - **File Storing Service** - отвечает за хранение и получение файлов
     - **File Analysis Service** - отвечает за анализ файлов и хранение результатов

2. ✅ **Обработка ошибок:**
   - Реализована обработка ошибок при недоступности одного из микросервисов
   - Клиенты микросервисов в API Gateway имеют механизмы повторных попыток и таймаутов

### Документация и качество кода

1. ✅ **Swagger документация:**
   - Реализована полная Swagger документация для всех API endpoints
   - Доступна через Swagger UI на порту 8081 или по адресу http://localhost:8080/swagger/index.html

2. ✅ **Качество кода:**
   - Код организован модульно с четким разделением ответственности
   - Документация включает описание архитектуры системы и спецификацию API

3. ✅ **Тестовое покрытие:**
   - Код покрыт тестами более чем на 65%
   - Команда `make test-coverage` генерирует отчет о покрытии кода

## Архитектура

Система состоит из трех микросервисов:

1. **API Gateway** - Отвечает за маршрутизацию запросов к соответствующим сервисам
2. **File Storing Service** - Отвечает за хранение и получение файлов
3. **File Analysis Service** - Отвечает за анализ файлов и хранение результатов

## Предварительные требования

- Docker и Docker Compose
- Go 1.20 или новее
- Swag (для генерации документации Swagger)
  ```bash
  go install github.com/swaggo/swag/cmd/swag@latest
  ```

## Начало работы

### Клонирование репозитория

```bash
git clone <repository-url>
cd kr-02
```

### Генерация документации Swagger

```bash
make swagger
```

### Сборка и запуск сервисов

```bash
docker-compose up -d
```

Это запустит все сервисы:
- База данных PostgreSQL на порту 5432
- File Storing Service на порту 50051
- File Analysis Service на порту 50052
- API Gateway на порту 8080 (HTTP)

## Документация API

### Генерация документации Swagger

```bash
make swagger
```

Это сгенерирует документацию Swagger с использованием swag на основе аннотаций в коде.

### Доступ к Swagger UI

http://localhost:8080/swagger/index.html

## Разработка

### Структура проекта

```
kr-02/
├── build/                    # Dockerfiles
│   ├── api_gateway/
│   ├── file_analysis_service/
│   └── file_storing_service/
├── cmd/                      # Точки входа для каждого сервиса
│   ├── api_gateway/
│   ├── file_analysis_service/
│   └── file_storing_service/
├── internal/                 # Внутренние пакеты
│   ├── pkg/                  # Общие пакеты
│   │   ├── api_gateway/      # Реализация API Gateway
│   │   │   ├── clients/      # Клиенты сервисов
│   │   │   ├── docs/         # Сгенерированная документация Swagger
│   │   │   └── handlers/     # HTTP обработчики
│   │   ├── file_analysis/    # Реализация File Analysis Service
│   │   └── file_storing/     # Реализация File Storing Service
│   └── proto/                # Сгенерированные proto файлы для gRPC сервисов
├── proto/                    # Proto определения для gRPC сервисов
├── scripts/                  # Вспомогательные скрипты
└── tests/                    # Тесты
```

### Запуск тестов с покрытием

Для запуска всех тестов и генерации отчета о покрытии кода:

```bash
make test-coverage
```

Эта команда:
1. Запускает все тесты в проекте
2. Генерирует отчет о покрытии кода в файле `coverage/coverage.out`
3. Создает HTML-версию отчета в файле `coverage/coverage.html`
4. Выводит в консоль сводку покрытия по функциям

Для просмотра HTML-отчета откройте файл `coverage/coverage.html` в браузере.

!!! ВАЖНО !!!

Нужно смотреть на последние 3 строчки вывода, так как там процент покрытия БЕЗ учета:
- генерируемых файлов
- mock-версий объектов (так как, они не относятся к работе программы, нужны только для тестов)
- самого файла, который просчитывает покрытие